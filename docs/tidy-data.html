<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Tidy Data | A Minimal Introduction to Data Management</title>
  <meta name="description" content="This is a minimal introduction to data management handling data in R compiled for the Biological Sciences BSc(Honours) class at the University of Cape Town." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Tidy Data | A Minimal Introduction to Data Management" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal introduction to data management handling data in R compiled for the Biological Sciences BSc(Honours) class at the University of Cape Town." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Tidy Data | A Minimal Introduction to Data Management" />
  
  <meta name="twitter:description" content="This is a minimal introduction to data management handling data in R compiled for the Biological Sciences BSc(Honours) class at the University of Cape Town." />
  

<meta name="author" content="Jasper Slingsby" />


<meta name="date" content="2022-04-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data.html"/>
<link rel="next" href="references.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Minimal Data Management</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#general"><i class="fa fa-check"></i><b>1.1</b> General</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#lecturesdiscussionstutorials"><i class="fa fa-check"></i><b>1.2</b> Lectures/Discussions/Tutorials</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#deliverables-due-thursday-the-14th-april"><i class="fa fa-check"></i><b>1.3</b> Deliverables (Due Thursday the 14th April)</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#setup"><i class="fa fa-check"></i><b>1.4</b> Software installation and setup</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="reproducibility.html"><a href="reproducibility.html"><i class="fa fa-check"></i><b>2</b> Reproducible research</a>
<ul>
<li class="chapter" data-level="2.1" data-path="reproducibility.html"><a href="reproducibility.html#the-reproducibility-crisis"><i class="fa fa-check"></i><b>2.1</b> The Reproducibility Crisis</a></li>
<li class="chapter" data-level="2.2" data-path="reproducibility.html"><a href="reproducibility.html#replication-and-the-reproducibility-spectrum"><i class="fa fa-check"></i><b>2.2</b> Replication and the Reproducibility Spectrum</a></li>
<li class="chapter" data-level="2.3" data-path="reproducibility.html"><a href="reproducibility.html#why-work-reproducibly"><i class="fa fa-check"></i><b>2.3</b> Why work reproducibly?</a></li>
<li class="chapter" data-level="2.4" data-path="reproducibility.html"><a href="reproducibility.html#barriers-to-working-reproducibly"><i class="fa fa-check"></i><b>2.4</b> Barriers to working reproducibly</a></li>
<li class="chapter" data-level="2.5" data-path="reproducibility.html"><a href="reproducibility.html#reproducible-scientific-workflows"><i class="fa fa-check"></i><b>2.5</b> Reproducible Scientific Workflows</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="reproducibility.html"><a href="reproducibility.html#file-and-folder-management"><i class="fa fa-check"></i><b>2.5.1</b> File and folder management</a></li>
<li class="chapter" data-level="2.5.2" data-path="reproducibility.html"><a href="reproducibility.html#coding-and-code-management"><i class="fa fa-check"></i><b>2.5.2</b> Coding and code management</a></li>
<li class="chapter" data-level="2.5.3" data-path="reproducibility.html"><a href="reproducibility.html#computing-environment-and-software"><i class="fa fa-check"></i><b>2.5.3</b> Computing environment and software</a></li>
<li class="chapter" data-level="2.5.4" data-path="reproducibility.html"><a href="reproducibility.html#sharing-of-the-data-code-publication-etc"><i class="fa fa-check"></i><b>2.5.4</b> Sharing of the data, code, publication etc</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>3</b> Data Management</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data.html"><a href="data.html#why-do-you-need-to-manage-your-data"><i class="fa fa-check"></i><b>3.1</b> Why do you need to manage your data?</a></li>
<li class="chapter" data-level="3.2" data-path="data.html"><a href="data.html#the-data-life-cycle"><i class="fa fa-check"></i><b>3.2</b> The Data Life Cycle</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data.html"><a href="data.html#plan"><i class="fa fa-check"></i><b>3.2.1</b> Plan</a></li>
<li class="chapter" data-level="3.2.2" data-path="data.html"><a href="data.html#collect-and-assure"><i class="fa fa-check"></i><b>3.2.2</b> Collect and Assure</a></li>
<li class="chapter" data-level="3.2.3" data-path="data.html"><a href="data.html#describe"><i class="fa fa-check"></i><b>3.2.3</b> Describe</a></li>
<li class="chapter" data-level="3.2.4" data-path="data.html"><a href="data.html#preserve"><i class="fa fa-check"></i><b>3.2.4</b> Preserve</a></li>
<li class="chapter" data-level="3.2.5" data-path="data.html"><a href="data.html#discover"><i class="fa fa-check"></i><b>3.2.5</b> Discover</a></li>
<li class="chapter" data-level="3.2.6" data-path="data.html"><a href="data.html#integrate"><i class="fa fa-check"></i><b>3.2.6</b> Integrate</a></li>
<li class="chapter" data-level="3.2.7" data-path="data.html"><a href="data.html#analyze"><i class="fa fa-check"></i><b>3.2.7</b> Analyze</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data.html"><a href="data.html#data-and-decisions"><i class="fa fa-check"></i><b>3.3</b> Data and decisions</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>4</b> Tidy Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tidy-data.html"><a href="tidy-data.html#data-entry"><i class="fa fa-check"></i><b>4.1</b> Data entry</a></li>
<li class="chapter" data-level="4.2" data-path="tidy-data.html"><a href="tidy-data.html#reproducibility---start-as-you-mean-to-finish"><i class="fa fa-check"></i><b>4.2</b> Reproducibility - start as you mean to finish</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="tidy-data.html"><a href="tidy-data.html#creating-a-git-repository-or-repo-for-short"><i class="fa fa-check"></i><b>4.2.1</b> Creating a Git repository (or repo for short)</a></li>
<li class="chapter" data-level="4.2.2" data-path="tidy-data.html"><a href="tidy-data.html#cloning-your-repo-to-your-local-machine"><i class="fa fa-check"></i><b>4.2.2</b> Cloning your repo to your local machine</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="tidy-data.html"><a href="tidy-data.html#tidy-data-and-data-wrangling"><i class="fa fa-check"></i><b>4.3</b> Tidy data and data wrangling</a></li>
<li class="chapter" data-level="4.4" data-path="tidy-data.html"><a href="tidy-data.html#the-dataset"><i class="fa fa-check"></i><b>4.4</b> The dataset</a></li>
<li class="chapter" data-level="4.5" data-path="tidy-data.html"><a href="tidy-data.html#reading-data"><i class="fa fa-check"></i><b>4.5</b> Reading data</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="tidy-data.html"><a href="tidy-data.html#microsoft-excel-files-with-readxl-start-with-googlesheets"><i class="fa fa-check"></i><b>4.5.1</b> Microsoft Excel files with <em>readxl</em> (start with Googlesheets?)</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="tidy-data.html"><a href="tidy-data.html#a-quick-aside-on-data-types"><i class="fa fa-check"></i><b>4.6</b> A quick aside on data types</a></li>
<li class="chapter" data-level="4.7" data-path="tidy-data.html"><a href="tidy-data.html#a-quick-aside-on-data-structures"><i class="fa fa-check"></i><b>4.7</b> A quick aside on data structures</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Minimal Introduction to Data Management</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tidy-data" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Tidy Data</h1>
<p>This section is a demonstration of some of the <em>Tidyverse</em> tools for wrangling and tidying your data, but first you need to get your data into a digital format…</p>
<p><br></p>
<div id="data-entry" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Data entry</h2>
<p>Before we start, I should highlight that one very good way of reducing errors in data entry and improving quality assurance and quality control (QA/QC) is to make use of various forms of <strong>data validation</strong> like <strong>drop down lists</strong> and <strong>conditional formatting</strong>. These can be used to limit data types (i.e. avoids you entering text into a numeric column or vice versa), or limiting the range of values entered (e.g. 0 to 100 for percentages), or just highlighting values that are possible, but rare, and should be double-checked, like 100m tall trees. Unit errors are incredibly common in ecological data entry, especially for things like plant height where you may be measuring 20cm tall grasses and 20m tall trees!!! Drop down lists really come into their own when you’re working with lots of different Latin species names etc. Typos, spelling errors and synonyms can take weeks of work to fix! Restricting the names to a drop-down list from a known published taxonomic resource really makes a huge difference!</p>
<p><a href="https://docs.google.com/spreadsheets/d/1U9yNaJFyd6kb5vlKzHhcgM6sLEzw_xVtQxewpH7k0Ho/edit?usp=sharing">Here’s an example</a> from a vegetation survey practical I ran as part of the BIO3018F Ecology and Evolution 3rd-year field course. If you go to the <code>Sites</code> sheet, you’ll see that the first two columns <code>Site</code> and <code>Point</code> are drop-down lists that reference the <code>RangeLimits</code> spreadsheet, to make entry easy and to prevent spelling mistakes etc. You’ll also notice that the different columns have specified ranges, and that a number outside the range is entered (e.g. anything &gt;100 for <code>PercentBareSoil</code>) then the cell is highlighted with a warning. You can see the data validation rules by selecting a cell in the column of interest and clicking <code>Data &gt; Data validation</code></p>
<p>It’s often easy to forget to collect some measurements etc when in the field, like site-level information. Sometimes what I do to prevent this is set up the next data entry sheet (trait data in this case), to require that you fill in the site name from a drop-down list that is populated in the site data sheet. This limits the names you can use to only those that have site data, and serves as a reminder should you have forgotten. Check out the <code>SitePoint</code> column in the <code>Traits</code> sheet.</p>
<p>I’m not going to go into how to do data validation in spreadsheets, but here are links for:</p>
<ul>
<li><a href="https://support.microsoft.com/en-us/topic/fef13169-0a84-4b92-a5ab-d856b0d7c1f7#ID0EAABAAA=Data_validation&amp;ID0EBBD=Data_validation">Microsoft Excel</a></li>
<li><a href="https://cloud.google.com/blog/products/g-suite/pro-tip-how-create-dropdown-list-google-sheets-and-pointers-conditional-formatting">Google Sheets</a></li>
</ul>
<p>I’m sure there are plenty of other online resources too.</p>
<p><strong>One thing I really like</strong> about Google Sheets is that you can set your sheet to work in “offline mode” on your phone or tablet, which allows you to do data entry directly into the sheet in the field, which then syncs to your Google Drive when you go back online (I’d imagine you can do the same with MS Excel and One Drive, but I’ve never tried it). This really saves time (and errors) on entering written field data sheets into a spreadsheet later, and allows you to take advantage of the data validation rules in the field, which are harder to set up with pen or pencil… The only issue is that if you make a typo etc that isn’t caught by the data validation you’re likely to be stuck with it…</p>
<p><br></p>
</div>
<div id="reproducibility---start-as-you-mean-to-finish" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Reproducibility - start as you mean to finish</h2>
<p>Now that you have your data, the temptation is to open an R script and get analyzing, or worse yet, open your raw data file in a spreadsheeting programme and crack out a few simple graphs… <em><strong>WAIT!!!</strong></em></p>
<ol style="list-style-type: upper-alpha">
<li><p>Never do data analyses in your raw data files!!! These are your raw data, and they should stay that way. In fact, they should be set to be <em>read-only</em> so that you can’t edit them even if you wanted to. If you were to edit these files directly and make a mistake like say sort a column without sorting the rest of the table, that’s it! Alles is kaput! You need your raw data files so that you have somewhere to look when you suspect you’ve done something bad to your data.</p></li>
<li><p>Beyond data management, there’s code management, and version control software like GitHub is your friend, providing a backup of all your scripts, versioning (i.e. a record of changes of your scripts that you can <em>revert</em> should you need to - i.e. no more scripts named “analysis_final_final_FINAL.R”) and is a great tool for collaboration and sharing. In fact, GitHub can manage much more than just code, and can host your manuscript, output figures and tables, and even small datasets. Let’s start there.</p></li>
</ol>
<p><br></p>
<div id="creating-a-git-repository-or-repo-for-short" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Creating a Git repository (or repo for short)</h3>
<ol style="list-style-type: decimal">
<li>Go to your online GitHub account (e.g. <a href="https://github.com/jslingsby" class="uri">https://github.com/jslingsby</a>)</li>
<li>Click on the <code>+</code> in the top-right and select <code>New repository</code></li>
<li>Give your repository a name and description</li>
<li>Choose whether you want the repo to be public or private (e.g. if you’re going to include sensitive data or otherwise don;t want the world to see what you’re doing)</li>
<li>I usually <code>Add a README</code> file, that allows you to write a description of the project, explain the contents of the repo, etc</li>
<li>I also usually <code>Add .gitignore</code> and choose <code>R</code> from the templates. This is a file that allows you to list files and folders that you don’t want GitHub to sync</li>
</ol>
<ul>
<li>e.g. you may want to have a “bigdata” folder on your local machine with files too large to sync to GitHub (~&gt;50MB), although check out <a href="https://docs.github.com/en/repositories/working-with-files/managing-large-files/about-git-large-file-storage">Git Large File Storage</a>, or an “output” folder with large figures etc that you can easily reproduce from the code</li>
</ul>
<ol start="7" style="list-style-type: decimal">
<li>Add a license if you want too</li>
<li>Click <code>Create repository</code></li>
</ol>
<p><br></p>
</div>
<div id="cloning-your-repo-to-your-local-machine" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Cloning your repo to your local machine</h3>
<ol style="list-style-type: decimal">
<li>Open RStudio on your laptop (you should already have RStudio and GitHub set up as per the instructions in section <a href="index.html#setup">1.4</a>)</li>
<li>Copy the URL to the repo you just created(e.g. <a href="https://github.com/jslingsby/demo" class="uri">https://github.com/jslingsby/demo</a>)</li>
<li>In RStudio:</li>
</ol>
<ul>
<li>in the top-right of the window you’ll see <code>Project: (None)</code> - click on it and select <code>New Project</code> then <code>Version Control</code> then <code>Git</code></li>
<li>In the <code>Repository URl:</code> box paste the URL to your repo</li>
<li><code>Project directory name</code> should fill automatically</li>
<li>For <code>Create project as subdirectory of:</code> hit <code>Browse</code> and navigate through your file system to where you want to put your folder for storing your Git repositories. I recommend something like <code>~Documents/GIT</code> (If you’ve used Git before you may have set this already and can skip this step)</li>
<li>Click <code>Create Repository</code></li>
</ul>
<p>You should now see the name of your project/repo in the top-right corner of RStudio where previously you saw <code>Project: (None)</code> and you’re good to go.</p>
<p>Now you need to set up a folder structure for code, output, data etc. Then you can open an R script, or better yet, an <a href="https://rmarkdown.rstudio.com/lesson-1.html">RMarkdown document</a> that allows you to write text and embed code and images etc.</p>
<p><br></p>
</div>
</div>
<div id="tidy-data-and-data-wrangling" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Tidy data and data wrangling</h2>
<p>Now you’re finally ready to start interrogating your data! But the raw data probably aren’t in a particularly analysis-friendly format, so you need to start with some data tidying and wrangling. You could do this “manually” in a new, appropriately named, copy of your raw data spreadsheet, but then you may not be able to track the changes you’ve made and errors may creep in. Where possible, it’s best to do this step with code. Most of my projects start with a “00_data_cleaning.R” script or similar to read the raw data and create an analysis-ready dataset. If this script takes a long time to run, I may output a new “clean data” file (or files) so that I don’t need to rerun the script every time.</p>
<p>As you know from the readings for the course, there are many reasons why you should keep your data in <em>tidy</em> format <span class="citation">(<a href="#ref-Wickham2014" role="doc-biblioref">Wickham 2014</a>)</span>. Unfortunately, as my spreadsheet above demonstrates, it’s not always convenient to enter your data in <em>tidy</em> format, so you inevitably end out needing to do post-entry data formatting. A major problem here is that doing the reformatting manually creates opportunities for introducing errors. This is where it’s a major advantage if you know how to <em>wrangle</em> your data in a coding language like R or Python. This is not to say that coded data wrangling cannot introduce errors!!! You should always do sanity checks!!! But I’d suspect that most of the errors you can make with code will be very obvious, because the outcome is usually spectacularly different to the input.</p>
<p>The rest of this section provides a demonstration of some of the functionality of the <a href="https://www.tidyverse.org/"><em>tidyverse</em></a> set of R packages, and some of the more common data wrangling errors made in R.</p>
<p><br></p>
</div>
<div id="the-dataset" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> The dataset</h2>
<p>This tutorial relies on the BIO3018F prac data mentioned previously (see link above). See <a href="https://github.com/PlantEcologi/BIO3018F_2022/blob/main/PracMaster.pdf">here</a> if you’d like more details about the data and practical.</p>
<p><br></p>
</div>
<div id="reading-data" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Reading data</h2>
<p>R has a number of different packages to read in data, and there’s even a few that work with different tabular data types just within the <em>tidyverse</em>. These include:</p>
<ul>
<li><a href="https://readr.tidyverse.org/"><em>readr</em></a> for text files</li>
<li><a href="https://readxl.tidyverse.org/"><em>readxl</em></a> for Microsoft Excel files (.xls or .xlsx)</li>
<li><a href="https://googlesheets4.tidyverse.org/"><em>googlesheets4</em></a> for reading data directly from a Google Sheet</li>
</ul>
<p>There’s <a href="https://www.tidyverse.org/packages/#import">others too</a> that can scrape data from web pages, interact with web APIs, or query local or online databases.</p>
<p>Fortunately, within the <em>tidyverse</em>, similar syntax can be used across most data import packages. Check out the <a href="https://raw.githubusercontent.com/rstudio/cheatsheets/main/data-import.pdf">cheat sheet</a>.</p>
<div id="microsoft-excel-files-with-readxl-start-with-googlesheets" class="section level3" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> Microsoft Excel files with <em>readxl</em> (start with Googlesheets?)</h3>
<p>First, we may want to know what files are in our data folder, which we can do with the base function <code>list.files()</code>.</p>
<blockquote>
<p><strong>NOTE:</strong> you need to replace the working directory folder path (“data” here) with wherever you put the data on your computer.</p>
</blockquote>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="tidy-data.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get list of files in the folder (change to your own)</span></span>
<span id="cb1-2"><a href="tidy-data.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(<span class="st">&quot;data&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;pnas.1619014114.sd01.xlsx&quot;           
## [2] &quot;pracdatasheet.xlsx&quot;                  
## [3] &quot;Reproducibility Survey Raw Data.xlsx&quot;
## [4] &quot;Slingsby_TaylorPlots&quot;</code></pre>
<p>So we have:</p>
<ul>
<li>a bunch of RMarkdown files (.Rmd) that perform the analyses used in the paper. The .Rmd files output the .pdf documents of the same name. We can ignore all of these.</li>
<li>a bunch of text files in comma separated value format (.csv). These are essentially spreadsheets, where the columns are denoted by commas.</li>
<li>one Microsoft Excel (.xlsx) file.</li>
</ul>
<p>Let’s have a look at the .xlsx file</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="tidy-data.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb3-2"><a href="tidy-data.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl) <span class="co">#while readxl is part of the tidyverse and installed when you install the tidyverse, it isn&#39;t a core package, so you have to call it separately</span></span>
<span id="cb3-3"><a href="tidy-data.html#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="tidy-data.html#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># See what sheets are in the Excel workbook</span></span>
<span id="cb3-5"><a href="tidy-data.html#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">excel_sheets</span>(<span class="st">&quot;data/pracdatasheet.xlsx&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Sites&quot;        &quot;Traits&quot;       &quot;Species&quot;      &quot;RangeLimits&quot;  &quot;RangeSpecies&quot;</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="tidy-data.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in data</span></span>
<span id="cb5-2"><a href="tidy-data.html#cb5-2" aria-hidden="true" tabindex="-1"></a>edat <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(<span class="st">&quot;data/pracdatasheet.xlsx&quot;</span>, <span class="at">sheet =</span> <span class="st">&quot;Sites&quot;</span>)</span>
<span id="cb5-3"><a href="tidy-data.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="tidy-data.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a summary of the data (</span><span class="al">WARNING</span><span class="co"> - doing this is usually a bad idea when not using tidyverse packages - it would usually show you all the data...)</span></span>
<span id="cb5-5"><a href="tidy-data.html#cb5-5" aria-hidden="true" tabindex="-1"></a>edat</span></code></pre></div>
<pre><code>## # A tibble: 24 × 8
##    Site      Point SitePoint PercentBareSoil SoilPH SoilColour  Dung Densiometer
##    &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;               &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;       &lt;dbl&gt;
##  1 grass     SE    grass_SE                0   4.6  7.5YR3/2       0          15
##  2 renoster… SE    renoster…               5   5.4  10YR3/2        3          14
##  3 invasion  SE    invasion…               0   3.79 10YR2/1        0           0
##  4 sand      SE    sand_SE                10   4.82 10YR6/4        0           5
##  5 sandstone SE    sandston…               5   4.91 10YR3/2        0           2
##  6 limestone SE    limeston…               0   6.48 10YR2/1        0           9
##  7 grass     NE    grass_NE                0   5.13 10YR2/2        0          13
##  8 renoster… NE    renoster…              30   5.7  7.5YR4/3       2          20
##  9 invasion  NE    invasion…               5   3.7  10YR5/1        0           0
## 10 sand      NE    sand_NE                 8   4.54 10YR4/3        0           4
## # … with 14 more rows</code></pre>
<p>You’ll note <code>&lt;chr&gt;</code> and <code>&lt;dbl&gt;</code> in the output. These indicate that the data types (or classes) for those columns are “character” and “double” respectively…</p>
</div>
</div>
<div id="a-quick-aside-on-data-types" class="section level2" number="4.6">
<h2><span class="header-section-number">4.6</span> A quick aside on data types</h2>
<ul>
<li>R’s basic data types are character, integer, numeric (or double, they are synonymous), complex, and logical.
<ul>
<li><code>integer</code> is for whole numbers (i.e. no decimals)</li>
<li><code>numeric</code> or <code>double</code> (double precision floating point numbers) are <em>real numbers</em> - i.e. they include decimal places.
<ul>
<li>For reasons I won’t explain, storing data as real numbers takes up far more memory than integers. Obviously, lots of numbers we work with are real numbers, so we need to be able to work with them. Interestingly, large data storage and transmission projects (e.g. satellite remote sensing) often do tricks like multiply values by some constant so that all data stored are integers. You need to correct by the constant during your analysis to get values in the actual unit of measurement.</li>
</ul></li>
<li><code>logical</code> is the outcome of a conditional statement (i.e. values can only be <code>TRUE</code> or <code>FALSE</code>)</li>
<li><code>character</code> is for letters, words, sentences or mixed strings (i.e. letters and digits)</li>
<li><code>factor</code> is a set of levels (often treatments) that you’d use in an analysis. They are very useful, but they are also VERY likely to trip you up at some stage (I’ll explain why in a minute)!!!
<ul>
<li>factors are essentially numerical codings of character data in some order. Using mumerical coding is useful, because you can order your levels in an analysis - e.g. <em>Treatment A, Treatment B, Control,</em> etc. They are also useful, because they can store data efficiently. For example, if your analysis has thousands of data points, it uses much less memory to recode the treatments above as <em>1, 2, 3,</em> etc and just store one copy of the levels (what we call the labels in a factors).</li>
<li><code>logical</code> is actually just a special case of factor data where FALSE = 0 and TRUE = 1. That said, R treats logical in specific ways that can’t be done with true factors and vice versa, so forget said that.</li>
</ul></li>
</ul></li>
</ul>
<p><br></p>
<p>Here’re some code examples to try to drive this home, using the built in vector `letters</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="tidy-data.html#cb7-1" aria-hidden="true" tabindex="-1"></a>letters</span></code></pre></div>
<pre><code>##  [1] &quot;a&quot; &quot;b&quot; &quot;c&quot; &quot;d&quot; &quot;e&quot; &quot;f&quot; &quot;g&quot; &quot;h&quot; &quot;i&quot; &quot;j&quot; &quot;k&quot; &quot;l&quot; &quot;m&quot; &quot;n&quot; &quot;o&quot; &quot;p&quot; &quot;q&quot; &quot;r&quot; &quot;s&quot;
## [20] &quot;t&quot; &quot;u&quot; &quot;v&quot; &quot;w&quot; &quot;x&quot; &quot;y&quot; &quot;z&quot;</code></pre>
<p>You can check the class of data using the function <code>class()</code></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="tidy-data.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(letters)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>And typically convert (or coerce) between classes using <code>as.</code> followed by the class you want, e.g.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="tidy-data.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.factor</span>(letters)</span></code></pre></div>
<pre><code>##  [1] a b c d e f g h i j k l m n o p q r s t u v w x y z
## Levels: a b c d e f g h i j k l m n o p q r s t u v w x y z</code></pre>
<p>Here it shows us that we have a factor with 26 values with 26 unique levels. You wouldn’t really use a factor class if all values are unique though. Here’s a better example.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="tidy-data.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.factor</span>(<span class="fu">rep</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="dv">8</span>))</span></code></pre></div>
<pre><code>##  [1] a b c a b c a b c a b c a b c a b c a b c a b c
## Levels: a b c</code></pre>
<p>And to prove that the factor represents the levels as a set of numbers:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="tidy-data.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(<span class="fu">rep</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="dv">8</span>)))</span></code></pre></div>
<pre><code>##  [1] 1 2 3 1 2 3 1 2 3 1 2 3 1 2 3 1 2 3 1 2 3 1 2 3</code></pre>
<p>Note that this doesn’t work if we try to coerce the the letters to numbers without making them a factor first:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="tidy-data.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">rep</span>(letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="dv">8</span>))</span></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre><code>##  [1] NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA NA</code></pre>
<p><br></p>
<p><strong>Here’s how factors will catch you out, sooner or later…</strong></p>
<p>As I said earlier, storing data as a factor can be less memory intensive. R takes advantage of this in that some functions (especially when reading in data) try to identify the most sensible data type and store it in R’s memory as such. So for example, if all the valuesin a column of a table are whole numbers, R will read it in as class integer, which requires less memory than class numeric (or double). By the same token, if the column is text and some values are repeated, R will often make it class factor.</p>
<p>This is great, but it can catch you out as follows. If a column of numbers has any text in it, R will make the whole column class character. If many of the values are repeated, it may even make it class factor for efficiency. <strong><em>This happens a lot!</em></strong>, especially if someone makes an error and types in an O instead of a 0, or denotes missing data with a “.” or anything else other than “NA.”</p>
<p>The problem is that even though R typically orders factors in alphabetical or numerical order, <strong>it is possible to create a mismatch between the actual number and the order in the levels.</strong></p>
<p>Here are some code examples. Firstly, where a number is treated as a character.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="tidy-data.html#cb20-1" aria-hidden="true" tabindex="-1"></a>hmm <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="st">&quot;0&quot;</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">1</span>), <span class="dv">3</span>)</span>
<span id="cb20-2"><a href="tidy-data.html#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="tidy-data.html#cb20-3" aria-hidden="true" tabindex="-1"></a>hmm</span></code></pre></div>
<pre><code>##  [1] &quot;4&quot; &quot;0&quot; &quot;2&quot; &quot;5&quot; &quot;3&quot; &quot;1&quot; &quot;4&quot; &quot;0&quot; &quot;2&quot; &quot;5&quot; &quot;3&quot; &quot;1&quot; &quot;4&quot; &quot;0&quot; &quot;2&quot; &quot;5&quot; &quot;3&quot; &quot;1&quot;</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="tidy-data.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(hmm)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<p>In this case the vector is class character, but if we’d read it in from a file it would likely have been made a factor. Let’s see what happens when we coerce it to factor:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="tidy-data.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.factor</span>(hmm)</span></code></pre></div>
<pre><code>##  [1] 4 0 2 5 3 1 4 0 2 5 3 1 4 0 2 5 3 1
## Levels: 0 1 2 3 4 5</code></pre>
<p>Seems ok?</p>
<p>What if we try to coerce that factor to a number?</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="tidy-data.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(hmm))</span></code></pre></div>
<pre><code>##  [1] 5 1 3 6 4 2 5 1 3 6 4 2 5 1 3 6 4 2</code></pre>
<p>Ouch! While the level labels start at 0, the numeric representation of the levels start at 1, so coercing them to numbers creates a mismatch…</p>
<p><strong>If you need to fix this, you should always coerce to character first.</strong></p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="tidy-data.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(<span class="fu">as.factor</span>(hmm)))</span></code></pre></div>
<pre><code>##  [1] 4 0 2 5 3 1 4 0 2 5 3 1 4 0 2 5 3 1</code></pre>
<p>What about if we insert a character instead of a number, like “O” instead of “0”</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="tidy-data.html#cb30-1" aria-hidden="true" tabindex="-1"></a>hmm2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">4</span>, <span class="st">&quot;O&quot;</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">1</span>), <span class="dv">3</span>)</span>
<span id="cb30-2"><a href="tidy-data.html#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="tidy-data.html#cb30-3" aria-hidden="true" tabindex="-1"></a>hmm2</span></code></pre></div>
<pre><code>##  [1] &quot;4&quot; &quot;O&quot; &quot;2&quot; &quot;5&quot; &quot;3&quot; &quot;1&quot; &quot;4&quot; &quot;O&quot; &quot;2&quot; &quot;5&quot; &quot;3&quot; &quot;1&quot; &quot;4&quot; &quot;O&quot; &quot;2&quot; &quot;5&quot; &quot;3&quot; &quot;1&quot;</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="tidy-data.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(hmm2)</span></code></pre></div>
<pre><code>## [1] &quot;character&quot;</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="tidy-data.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.factor</span>(hmm2)</span></code></pre></div>
<pre><code>##  [1] 4 O 2 5 3 1 4 O 2 5 3 1 4 O 2 5 3 1
## Levels: 1 2 3 4 5 O</code></pre>
<p>Interesting, the “O” is now the 6th level, not the first… What if we coerce to numeric?</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="tidy-data.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">as.factor</span>(hmm2))</span></code></pre></div>
<pre><code>##  [1] 4 6 2 5 3 1 4 6 2 5 3 1 4 6 2 5 3 1</code></pre>
<p>Oops!!! Converting all your zeroes to sixes is really going to mess with your results!!!</p>
<p>And if we try our <code>as.character</code> fix?</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="tidy-data.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">as.character</span>(<span class="fu">as.factor</span>(hmm2)))</span></code></pre></div>
<pre><code>## Warning: NAs introduced by coercion</code></pre>
<pre><code>##  [1]  4 NA  2  5  3  1  4 NA  2  5  3  1  4 NA  2  5  3  1</code></pre>
<p>R doesn’t know what to do with the Os, so it makes them NA and gives you a warning. Watch out for this, because ignoring the warning and leaving out zero values could seriously bias your results!</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="tidy-data.html#cb41-1" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="fl">3.4</span>, <span class="fl">1.2</span>, <span class="dv">5</span>))</span>
<span id="cb41-2"><a href="tidy-data.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">as.numeric</span>(f)</span></code></pre></div>
<pre><code>## [1] 2 1 3</code></pre>
</div>
<div id="a-quick-aside-on-data-structures" class="section level2" number="4.7">
<h2><span class="header-section-number">4.7</span> A quick aside on data structures</h2>
<ul>
<li>R’s basic data structures include the vector, list, matrix, data frame, and factors</li>
</ul>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Wickham2014" class="csl-entry">
Wickham, Hadley. 2014. <span>“<span>Tidy Data</span>.”</span> <em>Journal of Statistical Software, Articles</em> 59 (10): 1–23. <a href="https://doi.org/10.18637/jss.v059.i10">https://doi.org/10.18637/jss.v059.i10</a>.
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="references.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/05-tidydata.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/jslingsby/data-management/blob/master/05-tidydata.Rmd",
"text": null
},
"download": ["data-management.pdf", "data-management.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
